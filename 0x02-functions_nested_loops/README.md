Understanding Functions and nested loops